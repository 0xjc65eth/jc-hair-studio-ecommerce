<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Filtros Avançado - JC Hair Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Animações customizadas */
        @keyframes slideInFromTop {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-slide-in-top {
            animation: slideInFromTop 0.6s ease-out;
        }

        .animate-fade-in-scale {
            animation: fadeInScale 0.5s ease-out;
        }

        .animate-bounce-in {
            animation: bounceIn 0.6s ease-out;
        }

        .product-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .filter-tag {
            animation: bounceIn 0.5s ease-out;
        }

        .loading-pulse {
            animation: pulse 2s infinite;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-8">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-light text-gray-900 mb-4 animate-slide-in-top">
                        PRODUTOS BRASILEIROS AUTÊNTICOS
                    </h1>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                        Sistema de Filtros Avançado para E-commerce de Beleza
                    </p>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 py-6">
            <!-- Sistema de Filtros Avançados -->
            <div class="bg-white shadow-lg rounded-xl overflow-hidden mb-8 animate-fade-in-scale">
                <!-- Header do Filtro -->
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-filter text-amber-600 text-xl"></i>
                            <h2 class="text-xl font-semibold text-gray-900">Filtros Avançados</h2>
                            <span id="activeFiltersCount" class="bg-amber-100 text-amber-800 px-2 py-1 rounded-full text-sm font-medium hidden">
                                0 filtros ativos
                            </span>
                        </div>
                        
                        <div class="flex items-center space-x-3">
                            <button id="clearAllFilters" class="hidden flex items-center space-x-2 text-gray-600 hover:text-red-600 transition-colors">
                                <i class="fas fa-undo text-sm"></i>
                                <span class="text-sm font-medium">Limpar Tudo</span>
                            </button>
                            
                            <button id="mobileFilterToggle" class="lg:hidden flex items-center space-x-2 bg-white px-4 py-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors">
                                <span class="text-sm font-medium">Filtros</span>
                                <i class="fas fa-chevron-down text-sm transition-transform" id="filterToggleIcon"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Busca com Autocomplete -->
                    <div class="relative">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="Buscar produtos, marcas ou categorias..."
                                class="w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all"
                            />
                            <button id="clearSearch" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <!-- Sugestões de Autocomplete -->
                        <div id="searchSuggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-50 mt-1 hidden">
                        </div>
                    </div>
                </div>

                <!-- Filtros Ativos -->
                <div id="activeFiltersContainer" class="p-4 bg-gray-50 border-b border-gray-200 hidden">
                    <div id="activeFiltersList" class="flex flex-wrap gap-2">
                    </div>
                </div>

                <!-- Painel de Filtros -->
                <div id="filtersPanel" class="hidden lg:block transition-all duration-300">
                    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-6 p-6">
                        
                        <!-- Categorias -->
                        <div class="space-y-3">
                            <h3 class="font-semibold text-gray-900 flex items-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                Categorias
                            </h3>
                            <div class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar" id="categoriesFilter">
                            </div>
                        </div>

                        <!-- Marcas -->
                        <div class="space-y-3">
                            <h3 class="font-semibold text-gray-900 flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                Marcas
                            </h3>
                            <div class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar" id="brandsFilter">
                            </div>
                        </div>

                        <!-- Preço e Avaliação -->
                        <div class="space-y-6">
                            <!-- Preço -->
                            <div class="space-y-3">
                                <h3 class="font-semibold text-gray-900 flex items-center">
                                    <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                                    Faixa de Preço
                                </h3>
                                <div class="space-y-2" id="priceFilter">
                                </div>
                            </div>

                            <!-- Avaliação -->
                            <div class="space-y-3">
                                <h3 class="font-semibold text-gray-900 flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                    Avaliação
                                </h3>
                                <div class="space-y-2" id="ratingFilter">
                                </div>
                            </div>
                        </div>

                        <!-- Condição e Disponibilidade -->
                        <div class="space-y-6">
                            <!-- Condição -->
                            <div class="space-y-3">
                                <h3 class="font-semibold text-gray-900 flex items-center">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                                    Condição
                                </h3>
                                <div class="space-y-2" id="conditionFilter">
                                </div>
                            </div>

                            <!-- Disponibilidade -->
                            <div class="space-y-3">
                                <h3 class="font-semibold text-gray-900 flex items-center">
                                    <div class="w-3 h-3 bg-indigo-500 rounded-full mr-2"></div>
                                    Disponibilidade
                                </h3>
                                <div class="space-y-2" id="availabilityFilter">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controles de Visualização -->
            <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <p id="resultsCount" class="text-gray-600 font-medium">
                            <span class="text-amber-600 font-bold">0</span> produtos encontrados
                        </p>
                        <div id="loadingIndicator" class="flex items-center gap-2 hidden">
                            <div class="w-4 h-4 border-2 border-amber-600 border-t-transparent rounded-full animate-spin"></div>
                            <span class="text-gray-600">Filtrando...</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-sort text-gray-500"></i>
                            <select id="sortSelect" class="px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-sm">
                                <option value="name">Nome A-Z</option>
                                <option value="price-low">Preço: Menor</option>
                                <option value="price-high">Preço: Maior</option>
                                <option value="rating">Mais Avaliados</option>
                                <option value="newest">Mais Recentes</option>
                            </select>
                        </div>
                        
                        <div class="flex border border-gray-200 rounded-lg">
                            <button id="gridView" class="p-2 bg-amber-500 text-white rounded-l-lg transition-colors">
                                <i class="fas fa-th"></i>
                            </button>
                            <button id="listView" class="p-2 bg-white text-gray-600 rounded-r-lg transition-colors">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingCards" class="hidden">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Loading cards seria gerado dinamicamente -->
                </div>
            </div>

            <!-- Produtos -->
            <div id="productsContainer">
                <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Produtos serão carregados aqui -->
                </div>

                <!-- Estado vazio -->
                <div id="emptyState" class="text-center py-16 bg-white rounded-lg shadow-sm hidden">
                    <i class="fas fa-shopping-bag text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-medium text-gray-900 mb-2">Nenhum produto encontrado</h3>
                    <p class="text-gray-500">Tente ajustar seus filtros para ver mais resultados</p>
                </div>
            </div>

            <!-- Estatísticas -->
            <div id="statsContainer" class="mt-12 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl p-6 hidden">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center" id="statsGrid">
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Overlay para Mobile -->
    <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"></div>

    <script>
        // Dados simulados dos produtos
        const products = [
            {
                id: 'cadiveu_kit_001',
                nome: 'Kit Cadiveu Plástica dos Fios',
                marca: 'Cadiveu',
                categoria: 'Progressivas',
                subcategoria: 'Progressivas com Formol',
                descricao: 'Kit completo para alisamento profissional com resultados duradouros e brilho intenso',
                preco_eur: 140.67,
                preco_brl: 468.90,
                badge: 'BEST SELLER',
                estoque: true,
                rating: 5,
                image: 'https://via.placeholder.com/300x300/f59e0b/ffffff?text=Cadiveu'
            },
            {
                id: 'forever_liss_btx_001',
                nome: 'Forever Liss Botox Capilar',
                marca: 'Forever Liss',
                categoria: 'Tratamentos',
                subcategoria: 'BTX/Botox Capilar',
                descricao: 'Botox capilar para reconstrução e hidratação profunda dos fios',
                preco_eur: 39.87,
                preco_brl: 132.90,
                badge: 'PROMOÇÃO',
                estoque: true,
                rating: 4,
                image: 'https://via.placeholder.com/300x300/10b981/ffffff?text=Forever+Liss'
            },
            {
                id: 'mari_maria_base_001',
                nome: 'Mari Maria Base Cover Up Matte',
                marca: 'Mari Maria',
                categoria: 'Maquiagem',
                subcategoria: 'Bases',
                descricao: 'Base líquida de alta cobertura com acabamento matte e longa duração',
                preco_eur: 23.97,
                preco_brl: 79.90,
                badge: 'EXCLUSIVO',
                estoque: true,
                rating: 4,
                image: 'https://via.placeholder.com/300x300/8b5cf6/ffffff?text=Mari+Maria'
            },
            {
                id: 'boca_rosa_base_001',
                nome: 'Boca Rosa Beauty Stick Multifuncional',
                marca: 'Boca Rosa Beauty',
                categoria: 'Maquiagem',
                subcategoria: 'Bases',
                descricao: 'Stick multifuncional 3 em 1: base, contour e corretor',
                preco_eur: 26.97,
                preco_brl: 89.90,
                badge: 'NOVO',
                estoque: true,
                rating: 5,
                image: 'https://via.placeholder.com/300x300/ec4899/ffffff?text=Boca+Rosa'
            },
            {
                id: 'chapinha_babyliss',
                nome: 'Chapinha BaByliss Pro Titanium',
                marca: 'BaByliss',
                categoria: 'Ferramentas',
                subcategoria: 'Chapinhas',
                descricao: 'Chapinha profissional com placas de titânio e temperatura ajustável',
                preco_eur: 89.90,
                preco_brl: 299.90,
                badge: 'PREMIUM',
                estoque: false,
                rating: 5,
                image: 'https://via.placeholder.com/300x300/6366f1/ffffff?text=BaByliss'
            },
            {
                id: 'shampoo_tresemme',
                nome: 'Shampoo TRESemmé Reconstrução',
                marca: 'TRESemmé',
                categoria: 'Shampoos',
                subcategoria: 'Reconstrução',
                descricao: 'Shampoo para cabelos danificados com queratina e colágeno',
                preco_eur: 12.50,
                preco_brl: 41.90,
                estoque: true,
                rating: 4,
                image: 'https://via.placeholder.com/300x300/059669/ffffff?text=TRESemme'
            }
        ];

        // Estado dos filtros
        let filters = {
            search: '',
            category: [],
            brand: [],
            priceRange: [],
            rating: [],
            condition: [],
            availability: []
        };

        let currentViewMode = 'grid';
        let currentSortBy = 'name';
        let isLoading = false;

        // Configurações dos filtros
        const PRICE_RANGES = [
            { label: 'Até €50', value: '0-50', min: 0, max: 50 },
            { label: '€50 - €100', value: '50-100', min: 50, max: 100 },
            { label: '€100 - €200', value: '100-200', min: 100, max: 200 },
            { label: '€200+', value: '200+', min: 200, max: Infinity }
        ];

        const CONDITIONS = [
            { label: 'Novo', value: 'NOVO' },
            { label: 'Promoção', value: 'PROMOÇÃO' },
            { label: 'Destaque', value: 'BEST SELLER' },
            { label: 'Premium', value: 'PREMIUM' },
            { label: 'Exclusivo', value: 'EXCLUSIVO' }
        ];

        const AVAILABILITY = [
            { label: 'Em estoque', value: 'in_stock' },
            { label: 'Pré-venda', value: 'pre_order' }
        ];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            initializeFilters();
            initializeEventListeners();
            renderProducts();
            updateURL();
        });

        function initializeFilters() {
            // Extrair categorias e marcas únicas
            const categories = [...new Set([
                ...products.map(p => p.categoria),
                ...products.map(p => p.subcategoria)
            ])].filter(Boolean).sort();

            const brands = [...new Set(products.map(p => p.marca))].sort();

            // Renderizar filtros de categoria
            const categoriesContainer = document.getElementById('categoriesFilter');
            categories.forEach(category => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer group';
                label.innerHTML = `
                    <input type="checkbox" value="${category}" class="category-filter w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 transition-colors">
                    <span class="text-sm text-gray-700 group-hover:text-blue-600 transition-colors">${category}</span>
                `;
                categoriesContainer.appendChild(label);
            });

            // Renderizar filtros de marca
            const brandsContainer = document.getElementById('brandsFilter');
            brands.forEach(brand => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer group';
                label.innerHTML = `
                    <input type="checkbox" value="${brand}" class="brand-filter w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500 transition-colors">
                    <span class="text-sm text-gray-700 group-hover:text-green-600 transition-colors">${brand}</span>
                `;
                brandsContainer.appendChild(label);
            });

            // Renderizar filtros de preço
            const priceContainer = document.getElementById('priceFilter');
            PRICE_RANGES.forEach(range => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer group';
                label.innerHTML = `
                    <input type="checkbox" value="${range.value}" class="price-filter w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500 transition-colors">
                    <span class="text-sm text-gray-700 group-hover:text-purple-600 transition-colors">${range.label}</span>
                `;
                priceContainer.appendChild(label);
            });

            // Renderizar filtros de avaliação
            const ratingContainer = document.getElementById('ratingFilter');
            [5, 4, 3, 2, 1].forEach(rating => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer group';
                label.innerHTML = `
                    <input type="checkbox" value="${rating}" class="rating-filter w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500 transition-colors">
                    <div class="flex items-center space-x-1">
                        <div class="flex">
                            ${Array.from({length: 5}, (_, i) => 
                                `<i class="fas fa-star ${i < rating ? 'text-yellow-400' : 'text-gray-300'} text-sm"></i>`
                            ).join('')}
                        </div>
                        <span class="text-sm text-gray-700 group-hover:text-yellow-600 transition-colors">${rating}+ estrelas</span>
                    </div>
                `;
                ratingContainer.appendChild(label);
            });

            // Renderizar filtros de condição
            const conditionContainer = document.getElementById('conditionFilter');
            CONDITIONS.forEach(condition => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer group';
                label.innerHTML = `
                    <input type="checkbox" value="${condition.value}" class="condition-filter w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500 transition-colors">
                    <span class="text-sm text-gray-700 group-hover:text-red-600 transition-colors">${condition.label}</span>
                `;
                conditionContainer.appendChild(label);
            });

            // Renderizar filtros de disponibilidade
            const availabilityContainer = document.getElementById('availabilityFilter');
            AVAILABILITY.forEach(avail => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer group';
                label.innerHTML = `
                    <input type="checkbox" value="${avail.value}" class="availability-filter w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-colors">
                    <span class="text-sm text-gray-700 group-hover:text-indigo-600 transition-colors">${avail.label}</span>
                `;
                availabilityContainer.appendChild(label);
            });
        }

        function initializeEventListeners() {
            // Busca
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', debounce(handleSearchChange, 300));
            
            // Clear search
            document.getElementById('clearSearch').addEventListener('click', () => {
                filters.search = '';
                searchInput.value = '';
                document.getElementById('clearSearch').classList.add('hidden');
                applyFilters();
            });

            // Filtros de categoria
            document.addEventListener('change', (e) => {
                if (e.target.classList.contains('category-filter')) {
                    toggleArrayFilter('category', e.target.value, e.target.checked);
                } else if (e.target.classList.contains('brand-filter')) {
                    toggleArrayFilter('brand', e.target.value, e.target.checked);
                } else if (e.target.classList.contains('price-filter')) {
                    toggleArrayFilter('priceRange', e.target.value, e.target.checked);
                } else if (e.target.classList.contains('rating-filter')) {
                    toggleArrayFilter('rating', parseInt(e.target.value), e.target.checked);
                } else if (e.target.classList.contains('condition-filter')) {
                    toggleArrayFilter('condition', e.target.value, e.target.checked);
                } else if (e.target.classList.contains('availability-filter')) {
                    toggleArrayFilter('availability', e.target.value, e.target.checked);
                }
            });

            // Clear all filters
            document.getElementById('clearAllFilters').addEventListener('click', clearAllFilters);

            // Mobile toggle
            document.getElementById('mobileFilterToggle').addEventListener('click', toggleMobileFilters);

            // View mode
            document.getElementById('gridView').addEventListener('click', () => setViewMode('grid'));
            document.getElementById('listView').addEventListener('click', () => setViewMode('list'));

            // Sort
            document.getElementById('sortSelect').addEventListener('change', (e) => {
                currentSortBy = e.target.value;
                renderProducts();
            });

            // Mobile overlay
            document.getElementById('mobileOverlay').addEventListener('click', closeMobileFilters);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function handleSearchChange(e) {
            const value = e.target.value;
            filters.search = value;
            
            // Show/hide clear button
            const clearBtn = document.getElementById('clearSearch');
            if (value) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }

            // Show autocomplete suggestions
            showAutocompleteSuggestions(value);
            
            applyFilters();
        }

        function showAutocompleteSuggestions(query) {
            const suggestionsContainer = document.getElementById('searchSuggestions');
            
            if (query.length >= 2) {
                const suggestions = [...new Set([
                    ...products.filter(p => 
                        p.nome.toLowerCase().includes(query.toLowerCase())
                    ).map(p => p.nome),
                    ...products.filter(p => 
                        p.marca.toLowerCase().includes(query.toLowerCase())
                    ).map(p => p.marca),
                ])].slice(0, 5);
                
                if (suggestions.length > 0) {
                    suggestionsContainer.innerHTML = suggestions.map(suggestion => 
                        `<button class="w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0" 
                                onclick="selectSuggestion('${suggestion}')">${suggestion}</button>`
                    ).join('');
                    suggestionsContainer.classList.remove('hidden');
                } else {
                    suggestionsContainer.classList.add('hidden');
                }
            } else {
                suggestionsContainer.classList.add('hidden');
            }
        }

        function selectSuggestion(suggestion) {
            filters.search = suggestion;
            document.getElementById('searchInput').value = suggestion;
            document.getElementById('searchSuggestions').classList.add('hidden');
            document.getElementById('clearSearch').classList.remove('hidden');
            applyFilters();
        }

        function toggleArrayFilter(type, value, checked) {
            if (checked) {
                if (!filters[type].includes(value)) {
                    filters[type].push(value);
                }
            } else {
                filters[type] = filters[type].filter(item => item !== value);
            }
            applyFilters();
        }

        function toggleMobileFilters() {
            const panel = document.getElementById('filtersPanel');
            const overlay = document.getElementById('mobileOverlay');
            const icon = document.getElementById('filterToggleIcon');
            
            panel.classList.toggle('hidden');
            overlay.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }

        function closeMobileFilters() {
            const panel = document.getElementById('filtersPanel');
            const overlay = document.getElementById('mobileOverlay');
            const icon = document.getElementById('filterToggleIcon');
            
            panel.classList.add('hidden');
            overlay.classList.add('hidden');
            icon.classList.remove('rotate-180');
        }

        function setViewMode(mode) {
            currentViewMode = mode;
            
            // Update buttons
            const gridBtn = document.getElementById('gridView');
            const listBtn = document.getElementById('listView');
            
            if (mode === 'grid') {
                gridBtn.className = 'p-2 bg-amber-500 text-white rounded-l-lg transition-colors';
                listBtn.className = 'p-2 bg-white text-gray-600 rounded-r-lg transition-colors';
            } else {
                gridBtn.className = 'p-2 bg-white text-gray-600 rounded-l-lg transition-colors';
                listBtn.className = 'p-2 bg-amber-500 text-white rounded-r-lg transition-colors';
            }
            
            renderProducts();
        }

        function clearAllFilters() {
            filters = {
                search: '',
                category: [],
                brand: [],
                priceRange: [],
                rating: [],
                condition: [],
                availability: []
            };
            
            // Clear form inputs
            document.getElementById('searchInput').value = '';
            document.getElementById('clearSearch').classList.add('hidden');
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            applyFilters();
        }

        function removeFilter(type, value) {
            if (type === 'search') {
                filters.search = '';
                document.getElementById('searchInput').value = '';
                document.getElementById('clearSearch').classList.add('hidden');
            } else {
                filters[type] = filters[type].filter(item => item !== value);
                // Uncheck corresponding checkbox
                const checkbox = document.querySelector(`input[value="${value}"]`);
                if (checkbox) checkbox.checked = false;
            }
            applyFilters();
        }

        function applyFilters() {
            showLoading(true);
            
            setTimeout(() => {
                const filtered = filterProducts();
                renderProducts(filtered);
                updateActiveFiltersDisplay();
                updateURL();
                showLoading(false);
            }, 300); // Simulate API delay
        }

        function filterProducts() {
            return products.filter(product => {
                // Filtro de busca
                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    const searchMatch = 
                        product.nome.toLowerCase().includes(searchTerm) ||
                        product.marca.toLowerCase().includes(searchTerm) ||
                        product.categoria.toLowerCase().includes(searchTerm) ||
                        product.subcategoria.toLowerCase().includes(searchTerm);
                    
                    if (!searchMatch) return false;
                }

                // Filtro de categoria
                if (filters.category.length > 0) {
                    const categoryMatch = filters.category.some(cat => 
                        product.categoria === cat || product.subcategoria === cat
                    );
                    if (!categoryMatch) return false;
                }

                // Filtro de marca
                if (filters.brand.length > 0) {
                    if (!filters.brand.includes(product.marca)) return false;
                }

                // Filtro de preço
                if (filters.priceRange.length > 0) {
                    const priceMatch = filters.priceRange.some(range => {
                        const priceRangeObj = PRICE_RANGES.find(pr => pr.value === range);
                        if (!priceRangeObj) return false;
                        return product.preco_eur >= priceRangeObj.min && product.preco_eur <= priceRangeObj.max;
                    });
                    if (!priceMatch) return false;
                }

                // Filtro de avaliação
                if (filters.rating.length > 0) {
                    const ratingMatch = filters.rating.some(rating => product.rating >= rating);
                    if (!ratingMatch) return false;
                }

                // Filtro de condição
                if (filters.condition.length > 0) {
                    if (!product.badge || !filters.condition.includes(product.badge)) return false;
                }

                // Filtro de disponibilidade
                if (filters.availability.length > 0) {
                    const availabilityMatch = filters.availability.some(avail => {
                        if (avail === 'in_stock') return product.estoque;
                        if (avail === 'pre_order') return !product.estoque;
                        return true;
                    });
                    if (!availabilityMatch) return false;
                }

                return true;
            });
        }

        function renderProducts(filteredProducts = null) {
            if (!filteredProducts) {
                filteredProducts = filterProducts();
            }

            // Ordenar produtos
            const sortedProducts = [...filteredProducts].sort((a, b) => {
                switch (currentSortBy) {
                    case 'price-low':
                        return a.preco_eur - b.preco_eur;
                    case 'price-high':
                        return b.preco_eur - a.preco_eur;
                    case 'rating':
                        return b.rating - a.rating;
                    case 'name':
                        return a.nome.localeCompare(b.nome);
                    case 'newest':
                        return b.id.localeCompare(a.id);
                    default:
                        return 0;
                }
            });

            const container = document.getElementById('productsGrid');
            const emptyState = document.getElementById('emptyState');
            const statsContainer = document.getElementById('statsContainer');

            // Update results count
            document.getElementById('resultsCount').innerHTML = 
                `<span class="text-amber-600 font-bold">${sortedProducts.length}</span> produto${sortedProducts.length !== 1 ? 's' : ''} encontrado${sortedProducts.length !== 1 ? 's' : ''}`;

            if (sortedProducts.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                statsContainer.classList.add('hidden');
            } else {
                container.classList.remove('hidden');
                emptyState.classList.add('hidden');
                statsContainer.classList.remove('hidden');

                // Update grid class for view mode
                if (currentViewMode === 'grid') {
                    container.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6';
                } else {
                    container.className = 'space-y-6';
                }

                // Render products
                container.innerHTML = sortedProducts.map((product, index) => {
                    return currentViewMode === 'grid' ? renderProductCardGrid(product, index) : renderProductCardList(product, index);
                }).join('');

                // Update statistics
                updateStatistics(sortedProducts);
            }
        }

        function renderProductCardGrid(product, index) {
            const badgeColors = {
                'BEST SELLER': 'bg-gradient-to-r from-amber-400 to-yellow-500 text-black',
                'PROMOÇÃO': 'bg-gradient-to-r from-red-400 to-red-600 text-white',
                'NOVO': 'bg-gradient-to-r from-green-400 to-green-600 text-white',
                'PREMIUM': 'bg-gradient-to-r from-indigo-400 to-blue-600 text-white',
                'EXCLUSIVO': 'bg-gradient-to-r from-purple-400 to-purple-600 text-white'
            };

            return `
                <div class="product-card group bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 animate-fade-in-scale"
                     style="animation-delay: ${index * 50}ms">
                    <div class="relative">
                        ${product.badge ? `
                            <span class="absolute top-4 left-4 px-3 py-1 rounded-full text-xs font-bold z-10 ${badgeColors[product.badge] || 'bg-gray-500 text-white'}">
                                ${product.badge}
                            </span>
                        ` : ''}
                        
                        <button class="absolute top-4 right-4 p-2 bg-white bg-opacity-90 rounded-full hover:bg-opacity-100 transition-all z-10">
                            <i class="fas fa-heart text-gray-600 hover:text-red-500 transition-colors"></i>
                        </button>

                        <div class="aspect-square bg-gray-50 overflow-hidden">
                            <img src="${product.image}" alt="${product.nome}" 
                                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                        </div>
                    </div>

                    <div class="p-5">
                        <div class="text-amber-600 text-xs uppercase tracking-wider font-semibold mb-2">
                            ${product.marca}
                        </div>
                        
                        <h3 class="text-base font-semibold text-gray-900 mb-2 line-clamp-2 hover:text-amber-600 transition-colors cursor-pointer">
                            ${product.nome}
                        </h3>
                        
                        <p class="text-gray-600 text-sm mb-3 leading-relaxed line-clamp-2">
                            ${product.descricao}
                        </p>

                        <!-- Rating -->
                        <div class="flex items-center mb-3">
                            ${Array.from({length: 5}, (_, i) => 
                                `<i class="fas fa-star ${i < product.rating ? 'text-yellow-400' : 'text-gray-300'} text-xs"></i>`
                            ).join('')}
                            <span class="ml-1 text-xs text-gray-500">(${product.rating}.0)</span>
                        </div>
                        
                        <div class="flex items-center gap-2 mb-4">
                            <span class="text-lg font-bold text-amber-600">
                                €${product.preco_eur.toFixed(2)}
                            </span>
                            <span class="text-xs text-gray-400">
                                (R$ ${product.preco_brl.toFixed(2)})
                            </span>
                        </div>
                        
                        <button class="w-full ${product.estoque ? 'bg-gray-900 hover:bg-amber-600' : 'bg-gray-400 cursor-not-allowed'} text-white py-2.5 rounded-lg transition-colors font-medium text-sm tracking-wide">
                            ${product.estoque ? 'ADICIONAR AO CARRINHO' : 'INDISPONÍVEL'}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderProductCardList(product, index) {
            const badgeColors = {
                'BEST SELLER': 'bg-gradient-to-r from-amber-400 to-yellow-500 text-black',
                'PROMOÇÃO': 'bg-gradient-to-r from-red-400 to-red-600 text-white',
                'NOVO': 'bg-gradient-to-r from-green-400 to-green-600 text-white',
                'PREMIUM': 'bg-gradient-to-r from-indigo-400 to-blue-600 text-white',
                'EXCLUSIVO': 'bg-gradient-to-r from-purple-400 to-purple-600 text-white'
            };

            return `
                <div class="product-card bg-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 p-6 flex gap-6 animate-fade-in-scale"
                     style="animation-delay: ${index * 50}ms">
                    <div class="relative w-48 h-48 flex-shrink-0">
                        ${product.badge ? `
                            <span class="absolute top-2 left-2 px-2 py-1 rounded-full text-xs font-bold z-10 ${badgeColors[product.badge] || 'bg-gray-500 text-white'}">
                                ${product.badge}
                            </span>
                        ` : ''}
                        
                        <img src="${product.image}" alt="${product.nome}" 
                             class="w-full h-full object-cover rounded-lg">
                    </div>
                    
                    <div class="flex-1">
                        <div class="text-amber-600 text-sm uppercase tracking-wider font-semibold mb-2">
                            ${product.marca}
                        </div>
                        
                        <h3 class="text-xl font-semibold text-gray-900 mb-3 hover:text-amber-600 transition-colors cursor-pointer">
                            ${product.nome}
                        </h3>
                        
                        <p class="text-gray-600 mb-3 leading-relaxed">
                            ${product.descricao}
                        </p>

                        <!-- Rating -->
                        <div class="flex items-center mb-3">
                            ${Array.from({length: 5}, (_, i) => 
                                `<i class="fas fa-star ${i < product.rating ? 'text-yellow-400' : 'text-gray-300'} text-sm"></i>`
                            ).join('')}
                            <span class="ml-2 text-sm text-gray-500">(${product.rating}.0)</span>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl font-bold text-amber-600">
                                    €${product.preco_eur.toFixed(2)}
                                </span>
                                <span class="text-sm text-gray-400">
                                    (R$ ${product.preco_brl.toFixed(2)})
                                </span>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <button class="p-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-heart text-gray-600"></i>
                                </button>
                                <button class="${product.estoque ? 'bg-amber-600 hover:bg-amber-700' : 'bg-gray-400 cursor-not-allowed'} text-white px-6 py-2 rounded-lg transition-colors font-medium">
                                    ${product.estoque ? 'Adicionar ao Carrinho' : 'Indisponível'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateActiveFiltersDisplay() {
            const activeCount = 
                (filters.search ? 1 : 0) +
                filters.category.length +
                filters.brand.length +
                filters.priceRange.length +
                filters.rating.length +
                filters.condition.length +
                filters.availability.length;

            const countElement = document.getElementById('activeFiltersCount');
            const clearButton = document.getElementById('clearAllFilters');
            const activeContainer = document.getElementById('activeFiltersContainer');
            const activeList = document.getElementById('activeFiltersList');

            if (activeCount > 0) {
                countElement.textContent = `${activeCount} filtro${activeCount !== 1 ? 's' : ''} ativo${activeCount !== 1 ? 's' : ''}`;
                countElement.classList.remove('hidden');
                clearButton.classList.remove('hidden');
                activeContainer.classList.remove('hidden');

                // Render active filters
                let filtersHTML = '';

                if (filters.search) {
                    filtersHTML += `
                        <span class="filter-tag inline-flex items-center bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm">
                            Busca: "${filters.search}"
                            <button onclick="removeFilter('search')" class="ml-2 text-amber-600 hover:text-amber-800">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                    `;
                }

                filters.category.forEach(cat => {
                    filtersHTML += `
                        <span class="filter-tag inline-flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                            ${cat}
                            <button onclick="removeFilter('category', '${cat}')" class="ml-2 text-blue-600 hover:text-blue-800">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                    `;
                });

                filters.brand.forEach(brand => {
                    filtersHTML += `
                        <span class="filter-tag inline-flex items-center bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                            ${brand}
                            <button onclick="removeFilter('brand', '${brand}')" class="ml-2 text-green-600 hover:text-green-800">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                    `;
                });

                filters.priceRange.forEach(range => {
                    const rangeObj = PRICE_RANGES.find(pr => pr.value === range);
                    if (rangeObj) {
                        filtersHTML += `
                            <span class="filter-tag inline-flex items-center bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">
                                ${rangeObj.label}
                                <button onclick="removeFilter('priceRange', '${range}')" class="ml-2 text-purple-600 hover:text-purple-800">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </span>
                        `;
                    }
                });

                filters.rating.forEach(rating => {
                    filtersHTML += `
                        <span class="filter-tag inline-flex items-center bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm">
                            ${rating}+ ⭐
                            <button onclick="removeFilter('rating', ${rating})" class="ml-2 text-yellow-600 hover:text-yellow-800">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                    `;
                });

                filters.condition.forEach(condition => {
                    filtersHTML += `
                        <span class="filter-tag inline-flex items-center bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">
                            ${condition}
                            <button onclick="removeFilter('condition', '${condition}')" class="ml-2 text-red-600 hover:text-red-800">
                                <i class="fas fa-times text-xs"></i>
                            </button>
                        </span>
                    `;
                });

                filters.availability.forEach(avail => {
                    const availObj = AVAILABILITY.find(a => a.value === avail);
                    if (availObj) {
                        filtersHTML += `
                            <span class="filter-tag inline-flex items-center bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm">
                                ${availObj.label}
                                <button onclick="removeFilter('availability', '${avail}')" class="ml-2 text-indigo-600 hover:text-indigo-800">
                                    <i class="fas fa-times text-xs"></i>
                                </button>
                            </span>
                        `;
                    }
                });

                activeList.innerHTML = filtersHTML;
            } else {
                countElement.classList.add('hidden');
                clearButton.classList.add('hidden');
                activeContainer.classList.add('hidden');
            }
        }

        function updateStatistics(filteredProducts) {
            const statsGrid = document.getElementById('statsGrid');
            const brands = [...new Set(filteredProducts.map(p => p.marca))].length;
            const categories = [...new Set(filteredProducts.map(p => p.categoria))].length;
            const minPrice = Math.min(...filteredProducts.map(p => p.preco_eur));
            const maxPrice = Math.max(...filteredProducts.map(p => p.preco_eur));

            statsGrid.innerHTML = `
                <div>
                    <div class="text-2xl font-bold text-amber-600">${filteredProducts.length}</div>
                    <div class="text-sm text-gray-600">Produtos</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-amber-600">${brands}</div>
                    <div class="text-sm text-gray-600">Marcas</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-amber-600">${categories}</div>
                    <div class="text-sm text-gray-600">Categorias</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-amber-600">€${minPrice.toFixed(0)} - €${maxPrice.toFixed(0)}</div>
                    <div class="text-sm text-gray-600">Faixa de Preço</div>
                </div>
            `;
        }

        function showLoading(show) {
            isLoading = show;
            const loadingIndicator = document.getElementById('loadingIndicator');
            const loadingCards = document.getElementById('loadingCards');
            
            if (show) {
                loadingIndicator.classList.remove('hidden');
            } else {
                loadingIndicator.classList.add('hidden');
            }
        }

        function updateURL() {
            const params = new URLSearchParams();
            
            if (filters.search) params.set('search', filters.search);
            if (filters.category.length) params.set('category', filters.category.join(','));
            if (filters.brand.length) params.set('brand', filters.brand.join(','));
            if (filters.priceRange.length) params.set('price', filters.priceRange.join(','));
            if (filters.rating.length) params.set('rating', filters.rating.join(','));
            if (filters.condition.length) params.set('condition', filters.condition.join(','));
            if (filters.availability.length) params.set('availability', filters.availability.join(','));

            const url = params.toString() ? `${window.location.pathname}?${params.toString()}` : window.location.pathname;
            window.history.replaceState({}, '', url);
        }

        // Expose functions to global scope for onclick handlers
        window.removeFilter = removeFilter;
        window.selectSuggestion = selectSuggestion;
        window.clearAllFilters = clearAllFilters;
    </script>
</body>
</html>