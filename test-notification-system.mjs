#!/usr/bin/env node

/**
 * TESTE COMPLETO DO SISTEMA DE NOTIFICA√á√ïES - JC Hair Studio
 *
 * Este script executa testes exaustivos em TODOS os componentes do sistema:
 * 1. Teste de envio para admin (juliocesarurss65@gmail.com)
 * 2. Teste de confirma√ß√£o de pedido
 * 3. Teste de confirma√ß√£o de pagamento
 * 4. Teste de notifica√ß√£o de envio
 * 5. Teste com dados completos incluindo endere√ßo, telefone, etc
 * 6. Verifica√ß√£o de persist√™ncia no MongoDB
 * 7. Teste de retry com falhas simuladas
 *
 * Executar com: node test-notification-system.mjs
 *
 * @author JC Hair Studio Development Team
 * @version 3.0.0 - Sistema Ultra-Abrangente
 */

import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

// Configura√ß√µes do teste
const BASE_URL = process.env.TEST_BASE_URL || 'https://jchairstudios62.xyz';
const ADMIN_EMAIL = 'juliocesarurss65@gmail.com';

console.log(`
üß™ ======================================================================
üß™ SISTEMA DE TESTE ULTRA-ABRANGENTE DE NOTIFICA√á√ïES - JC HAIR STUDIO
üß™ ======================================================================
üåê Base URL: ${BASE_URL}
üìß Admin Email: ${ADMIN_EMAIL}
‚è∞ Iniciado em: ${new Date().toLocaleString('pt-BR')}
üß™ ======================================================================
`);

/**
 * TESTE 1: NOTIFICA√á√ÉO ADMIN DIRETA
 * Testa o envio direto para o email do admin com dados completos
 */
async function teste1_NotificacaoAdmin() {
  console.log('\nüìß TESTE 1: NOTIFICA√á√ÉO ADMIN DIRETA');
  console.log('-'.repeat(60));

  try {
    const testData = {
      action: 'test',
      testEmail: ADMIN_EMAIL
    };

    console.log('üìä Enviando dados de teste:', JSON.stringify(testData, null, 2));

    const response = await fetch(`${BASE_URL}/api/admin/notifications`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(testData),
    });

    const result = await response.json();

    if (response.ok) {
      console.log('‚úÖ Notifica√ß√£o admin: SUCESSO');
      console.log(`üìù Resposta: ${result.message}`);
      console.log(`üìä Resumo agentes: ${JSON.stringify(result.results, null, 2)}`);
      return true;
    } else {
      console.log('‚ùå Notifica√ß√£o admin: FALHA');
      console.log(`üìù Erro: ${result.error || 'Erro desconhecido'}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå Notifica√ß√£o admin: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * TESTE 2: CONFIRMA√á√ÉO DE PEDIDO COMPLETA
 * Testa o fluxo completo de confirma√ß√£o de pedido
 */
async function teste2_ConfirmacaoPedido() {
  console.log('\nüõçÔ∏è TESTE 2: CONFIRMA√á√ÉO DE PEDIDO COMPLETA');
  console.log('-'.repeat(60));

  const pedidoCompleto = {
    action: 'processOrder',
    orderId: `TESTE-${Date.now()}`,
    customerName: 'Jo√£o Silva Teste',
    customerEmail: 'joao.silva.teste@exemplo.com',
    customerPhone: '+351 912 345 678',
    customerDocument: '123.456.789-00',
    total: 189.90,
    subtotal: 169.90,
    shippingCost: 20.00,
    discount: 0.00,
    currency: 'EUR',
    status: 'pending', // Ainda n√£o pago
    paymentMethod: 'Cart√£o de Cr√©dito',
    paymentGateway: 'Stripe',
    products: [
      {
        name: 'Shampoo Hidratante Profissional 500ml',
        quantity: 2,
        price: 45.50,
        sku: 'SHP001',
        category: 'Shampoos'
      },
      {
        name: 'Condicionador Reparador 300ml',
        quantity: 1,
        price: 38.90,
        sku: 'CND002',
        category: 'Condicionadores'
      },
      {
        name: 'M√°scara Capilar Nutritiva 250ml',
        quantity: 1,
        price: 40.00,
        sku: 'MSC003',
        category: 'Tratamentos'
      }
    ],
    shippingAddress: {
      name: 'Jo√£o Silva Teste',
      street: 'Rua das Flores, 123, Apartamento 4B',
      complement: 'Pr√≥ximo ao mercado central',
      neighborhood: 'Centro',
      city: 'Lisboa',
      state: 'Lisboa',
      zipCode: '1000-001',
      country: 'Portugal',
      phone: '+351 912 345 678',
      notes: 'Entregar pela manh√£, porteiro dispon√≠vel 8h-18h'
    },
    deliveryMethod: 'Correios Express',
    shippingCarrier: 'CTT Expresso',
    estimatedDelivery: '3-5 dias √∫teis',
    clientIp: '192.168.1.100',
    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    source: 'Website Direct',
    campaign: 'Newsletter Promocional',
    sessionDuration: '00:12:34',
    pagesVisited: 8,
    createdAt: new Date().toISOString()
  };

  try {
    console.log('üì¶ Processando pedido completo...');

    const response = await fetch(`${BASE_URL}/api/admin/notifications`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(pedidoCompleto),
    });

    const result = await response.json();

    if (response.ok) {
      console.log('‚úÖ Confirma√ß√£o de pedido: SUCESSO');
      console.log(`üìù Mensagem: ${result.message}`);
      console.log(`üìä Agentes executados: ${result.summary?.successful}/${result.summary?.total}`);
      console.log('üìã Detalhes dos agentes:');
      result.summary?.details?.forEach(agent => {
        const status = agent.status === 'fulfilled' ? '‚úÖ' : '‚ùå';
        console.log(`  ${status} ${agent.agent}: ${agent.status}`);
        if (agent.error) console.log(`    ‚ö†Ô∏è Erro: ${agent.error.message || agent.error}`);
      });
      return true;
    } else {
      console.log('‚ùå Confirma√ß√£o de pedido: FALHA');
      console.log(`üìù Erro: ${result.error || 'Erro desconhecido'}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå Confirma√ß√£o de pedido: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * TESTE 3: CONFIRMA√á√ÉO DE PAGAMENTO
 * Testa o fluxo de confirma√ß√£o quando o pagamento √© aprovado
 */
async function teste3_ConfirmacaoPagamento() {
  console.log('\nüí≥ TESTE 3: CONFIRMA√á√ÉO DE PAGAMENTO');
  console.log('-'.repeat(60));

  const pagamentoAprovado = {
    paymentIntentId: `pi_teste_${Date.now()}`,
    customerInfo: {
      name: 'Maria Costa Exemplo',
      email: 'maria.costa.teste@exemplo.com',
      phone: '+351 934 567 890'
    },
    items: [
      {
        name: 'Kit Completo Hidrata√ß√£o Capilar',
        quantity: 1,
        price: 89.90
      },
      {
        name: '√ìleo Argan Premium 50ml',
        quantity: 2,
        price: 35.00
      }
    ],
    amount: 159.90,
    shippingAddress: {
      name: 'Maria Costa Exemplo',
      street: 'Avenida da Liberdade, 456',
      city: 'Porto',
      zipCode: '4000-001',
      country: 'Portugal'
    },
    deliveryMethod: 'Correios Standard'
  };

  try {
    console.log('üí∞ Processando confirma√ß√£o de pagamento...');

    const response = await fetch(`${BASE_URL}/api/payment-success`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(pagamentoAprovado),
    });

    const result = await response.json();

    if (response.ok) {
      console.log('‚úÖ Confirma√ß√£o de pagamento: SUCESSO');
      console.log(`üìù Mensagem: ${result.message}`);
      return true;
    } else {
      console.log('‚ùå Confirma√ß√£o de pagamento: FALHA');
      console.log(`üìù Erro: ${result.error || 'Erro desconhecido'}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå Confirma√ß√£o de pagamento: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * TESTE 4: NOTIFICA√á√ÉO DE ENVIO
 * Testa o envio de notifica√ß√£o quando o produto √© despachado
 */
async function teste4_NotificacaoEnvio() {
  console.log('\nüì¶ TESTE 4: NOTIFICA√á√ÉO DE ENVIO');
  console.log('-'.repeat(60));

  const produtoEnviado = {
    action: 'processOrder',
    orderId: `ENVIO-${Date.now()}`,
    customerName: 'Ana Rodrigues Teste',
    customerEmail: 'ana.rodrigues.teste@exemplo.com',
    customerPhone: '+351 967 890 123',
    total: 75.50,
    currency: 'EUR',
    status: 'shipped', // Status de enviado
    paymentMethod: 'MBWay',
    products: [
      {
        name: 'Leave-in Protetor T√©rmico',
        quantity: 1,
        price: 29.90,
        sku: 'LV001'
      },
      {
        name: 'Spray Fixador Professional',
        quantity: 2,
        price: 22.80,
        sku: 'SPR002'
      }
    ],
    shippingAddress: {
      name: 'Ana Rodrigues Teste',
      street: 'Rua da Paz, 789',
      city: 'Braga',
      zipCode: '4700-001',
      country: 'Portugal'
    },
    trackingCode: 'JC123456789PT', // C√≥digo de rastreamento
    trackingUrl: 'https://www.ctt.pt/feapl_2/app/open/postalObjectSearch.jspx?objects=JC123456789PT',
    shippingCarrier: 'CTT Expresso',
    estimatedDelivery: '2-3 dias √∫teis',
    createdAt: new Date().toISOString()
  };

  try {
    console.log('üöö Processando notifica√ß√£o de envio...');

    const response = await fetch(`${BASE_URL}/api/admin/notifications`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(produtoEnviado),
    });

    const result = await response.json();

    if (response.ok) {
      console.log('‚úÖ Notifica√ß√£o de envio: SUCESSO');
      console.log(`üìù Mensagem: ${result.message}`);
      console.log(`üìä Agentes executados: ${result.summary?.successful}/${result.summary?.total}`);
      return true;
    } else {
      console.log('‚ùå Notifica√ß√£o de envio: FALHA');
      console.log(`üìù Erro: ${result.error || 'Erro desconhecido'}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå Notifica√ß√£o de envio: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * TESTE 5: NEWSLETTER SIGNUP
 * Testa o cadastro na newsletter
 */
async function teste5_Newsletter() {
  console.log('\nüì¨ TESTE 5: NEWSLETTER SIGNUP');
  console.log('-'.repeat(60));

  const newsletterData = {
    email: 'newsletter.teste@exemplo.com',
    name: 'Subscritor Teste Newsletter'
  };

  try {
    console.log('üìß Testando cadastro na newsletter...');

    const response = await fetch(`${BASE_URL}/api/newsletter`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(newsletterData),
    });

    const result = await response.json();

    if (response.ok) {
      console.log('‚úÖ Newsletter signup: SUCESSO');
      console.log(`üìù Mensagem: ${result.message}`);
      return true;
    } else {
      console.log('‚ùå Newsletter signup: FALHA');
      console.log(`üìù Erro: ${result.error || 'Erro desconhecido'}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå Newsletter signup: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * TESTE 6: VERIFICA√á√ÉO DO MONGODB
 * Verifica se os dados est√£o sendo persistidos corretamente no MongoDB
 */
async function teste6_VerificacaoMongoDB() {
  console.log('\nüóÑÔ∏è TESTE 6: VERIFICA√á√ÉO DO MONGODB');
  console.log('-'.repeat(60));

  try {
    console.log('üîç Verificando estat√≠sticas do MongoDB...');

    const response = await fetch(`${BASE_URL}/api/admin/notifications`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      }
    });

    const result = await response.json();

    if (response.ok) {
      console.log('‚úÖ MongoDB verifica√ß√£o: SUCESSO');
      console.log('üìä Configura√ß√£o atual:');
      console.log(`  ‚Ä¢ Admin Email: ${result.config?.adminEmail}`);
      console.log(`  ‚Ä¢ Emails habilitados: ${result.config?.emailsEnabled ? 'Sim' : 'N√£o'}`);
      console.log(`  ‚Ä¢ Execu√ß√£o paralela: ${result.config?.parallelExecution ? 'Sim' : 'N√£o'}`);
      console.log(`  ‚Ä¢ Status do sistema: ${result.health}`);

      if (result.statistics && result.statistics.length > 0) {
        console.log('üìà Estat√≠sticas de notifica√ß√µes:');
        result.statistics.forEach(stat => {
          console.log(`  ‚Ä¢ Tipo: ${stat._id}`);
          console.log(`    - Total: ${stat.total}`);
          console.log(`    - Enviados: ${stat.sent}`);
          console.log(`    - Falhados: ${stat.failed}`);
        });
      } else {
        console.log('üìä Nenhuma estat√≠stica encontrada (primeira execu√ß√£o)');
      }
      return true;
    } else {
      console.log('‚ùå MongoDB verifica√ß√£o: FALHA');
      console.log(`üìù Erro: ${result.error || 'Erro desconhecido'}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå MongoDB verifica√ß√£o: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * TESTE 7: SISTEMA DE RETRY COM FALHAS
 * Testa o comportamento do sistema quando h√° falhas
 */
async function teste7_SistemaRetry() {
  console.log('\nüîÑ TESTE 7: SISTEMA DE RETRY COM FALHAS');
  console.log('-'.repeat(60));

  try {
    console.log('‚ö° Testando resili√™ncia do sistema...');

    // Teste com email inv√°lido para for√ßar falha
    const dadosComFalha = {
      action: 'processOrder',
      orderId: `RETRY-${Date.now()}`,
      customerName: 'Teste Retry System',
      customerEmail: 'email-invalido@dominio-inexistente.test.fail',
      total: 50.00,
      products: [
        {
          name: 'Produto Teste Retry',
          quantity: 1,
          price: 50.00
        }
      ],
      status: 'paid',
      createdAt: new Date().toISOString()
    };

    const response = await fetch(`${BASE_URL}/api/admin/notifications`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(dadosComFalha),
    });

    const result = await response.json();

    if (response.ok) {
      console.log('‚úÖ Sistema de retry: TESTADO');
      console.log(`üìù Resposta: ${result.message}`);
      console.log('üìä Resultado dos agentes:');
      result.summary?.details?.forEach(agent => {
        const status = agent.status === 'fulfilled' ? '‚úÖ Sucesso' : '‚ö†Ô∏è Falha esperada';
        console.log(`  ${status} - Agente ${agent.agent}`);
        if (agent.error) {
          console.log(`    üí° Erro capturado: ${agent.error.message || 'Sistema de retry funcionando'}`);
        }
      });
      return true;
    } else {
      console.log('‚ùå Sistema de retry: ERRO INESPERADO');
      console.log(`üìù Erro: ${result.error}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå Sistema de retry: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * TESTE 8: FORMUL√ÅRIO DE CONTATO
 * Testa o sistema de contato direto
 */
async function teste8_FormularioContato() {
  console.log('\nüìû TESTE 8: FORMUL√ÅRIO DE CONTATO');
  console.log('-'.repeat(60));

  const contatoData = {
    name: 'Cliente Teste Contato',
    email: 'contato.teste@exemplo.com',
    phone: '+351 988 776 655',
    subject: 'Teste do Sistema de Contato Autom√°tico',
    message: 'Esta √© uma mensagem de teste para verificar se o sistema de contato est√° funcionando corretamente. Se voc√™ est√° recebendo este email, significa que todos os componentes est√£o operacionais.',
    formType: 'support'
  };

  try {
    console.log('üìß Testando formul√°rio de contato...');

    const response = await fetch(`${BASE_URL}/api/contact`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(contatoData),
    });

    const result = await response.json();

    if (response.ok || response.status === 200) {
      console.log('‚úÖ Formul√°rio de contato: SUCESSO');
      console.log(`üìù Resposta: ${result.message || 'Contato enviado com sucesso'}`);
      return true;
    } else {
      console.log('‚ùå Formul√°rio de contato: FALHA');
      console.log(`üìù Erro: ${result.error || 'Erro desconhecido'}`);
      return false;
    }
  } catch (error) {
    console.log('‚ùå Formul√°rio de contato: ERRO DE CONEX√ÉO');
    console.log(`üìù Erro: ${error.message}`);
    return false;
  }
}

/**
 * FUN√á√ÉO PRINCIPAL - EXECUTAR TODOS OS TESTES
 * Executa todos os testes sequencialmente com delays para evitar sobrecarga
 */
async function executarTodosOsTestes() {
  const inicioTeste = Date.now();

  console.log('\nüöÄ INICIANDO BATERIA COMPLETA DE TESTES...\n');

  const resultados = {
    notificacaoAdmin: false,
    confirmacaoPedido: false,
    confirmacaoPagamento: false,
    notificacaoEnvio: false,
    newsletter: false,
    verificacaoMongoDB: false,
    sistemaRetry: false,
    formularioContato: false
  };

  // Executar testes sequencialmente com delay para n√£o sobrecarregar o sistema
  try {
    resultados.notificacaoAdmin = await teste1_NotificacaoAdmin();
    await delay(3000);

    resultados.confirmacaoPedido = await teste2_ConfirmacaoPedido();
    await delay(3000);

    resultados.confirmacaoPagamento = await teste3_ConfirmacaoPagamento();
    await delay(3000);

    resultados.notificacaoEnvio = await teste4_NotificacaoEnvio();
    await delay(3000);

    resultados.newsletter = await teste5_Newsletter();
    await delay(3000);

    resultados.verificacaoMongoDB = await teste6_VerificacaoMongoDB();
    await delay(3000);

    resultados.sistemaRetry = await teste7_SistemaRetry();
    await delay(3000);

    resultados.formularioContato = await teste8_FormularioContato();
  } catch (error) {
    console.error('‚ùå ERRO CR√çTICO DURANTE OS TESTES:', error);
  }

  // Calcular estat√≠sticas finais
  const fimTeste = Date.now();
  const duracaoTotal = Math.round((fimTeste - inicioTeste) / 1000);
  const sucessos = Object.values(resultados).filter(Boolean).length;
  const total = Object.keys(resultados).length;
  const percentualSucesso = Math.round((sucessos / total) * 100);

  // Relat√≥rio final detalhado
  console.log('\n' + '='.repeat(80));
  console.log('üìã RELAT√ìRIO FINAL COMPLETO - SISTEMA DE NOTIFICA√á√ïES');
  console.log('='.repeat(80));
  console.log(`‚è±Ô∏è Dura√ß√£o total dos testes: ${duracaoTotal} segundos`);
  console.log(`üìä Taxa de sucesso: ${sucessos}/${total} (${percentualSucesso}%)`);
  console.log(`üéØ URL testada: ${BASE_URL}`);
  console.log(`üìß Admin email: ${ADMIN_EMAIL}`);
  console.log('');

  // Detalhamento por teste
  console.log('üìù DETALHAMENTO POR TESTE:');
  console.log('-'.repeat(80));
  Object.entries(resultados).forEach(([teste, sucesso]) => {
    const emoji = sucesso ? '‚úÖ' : '‚ùå';
    const status = sucesso ? 'SUCESSO' : 'FALHA';
    const nomeFormatado = teste.replace(/([A-Z])/g, ' $1').toLowerCase().trim();
    console.log(`${emoji} ${status.padEnd(8)} - ${nomeFormatado}`);
  });

  console.log('');

  // An√°lise final
  if (sucessos === total) {
    console.log('üéâ EXCELENTE! TODOS OS TESTES PASSARAM!');
    console.log('üöÄ O sistema de notifica√ß√µes est√° funcionando perfeitamente!');
    console.log('üí™ Todos os componentes est√£o operacionais:');
    console.log('   ‚Ä¢ Emails para admin funcionando');
    console.log('   ‚Ä¢ Confirma√ß√µes de pedido funcionando');
    console.log('   ‚Ä¢ Confirma√ß√µes de pagamento funcionando');
    console.log('   ‚Ä¢ Notifica√ß√µes de envio funcionando');
    console.log('   ‚Ä¢ Newsletter funcionando');
    console.log('   ‚Ä¢ MongoDB persistindo dados');
    console.log('   ‚Ä¢ Sistema de retry resiliente');
    console.log('   ‚Ä¢ Formul√°rio de contato ativo');
  } else if (sucessos >= total * 0.75) {
    console.log('‚ö° BOM! A maioria dos testes passou!');
    console.log('üîß Alguns componentes podem precisar de aten√ß√£o.');
    console.log('üìã Verifique os testes que falharam acima.');
  } else if (sucessos >= total * 0.5) {
    console.log('‚ö†Ô∏è ATEN√á√ÉO! V√°rios testes falharam.');
    console.log('üõ†Ô∏è O sistema precisa de corre√ß√µes urgentes.');
    console.log('üìû Entre em contato com a equipe de desenvolvimento.');
  } else {
    console.log('üö® CR√çTICO! A maioria dos testes falharam!');
    console.log('üî• O sistema de notifica√ß√µes tem problemas s√©rios.');
    console.log('üöë Interven√ß√£o imediata necess√°ria!');
  }

  console.log('');
  console.log('üí° PR√ìXIMOS PASSOS RECOMENDADOS:');
  if (sucessos < total) {
    console.log('   1. Verificar configura√ß√µes do SendGrid');
    console.log('   2. Confirmar conectividade com MongoDB');
    console.log('   3. Validar vari√°veis de ambiente');
    console.log('   4. Testar conectividade de rede');
    console.log('   5. Revisar logs do servidor');
  } else {
    console.log('   1. Sistema est√° operacional');
    console.log('   2. Monitorar logs regularmente');
    console.log('   3. Executar testes semanalmente');
    console.log('   4. Manter backup dos dados');
  }

  console.log('');
  console.log(`‚è∞ Teste conclu√≠do em: ${new Date().toLocaleString('pt-BR')}`);
  console.log('='.repeat(80));

  return {
    resultados,
    sucessos,
    total,
    percentualSucesso,
    duracaoTotal,
    status: sucessos === total ? 'PERFEITO' :
            sucessos >= total * 0.75 ? 'BOM' :
            sucessos >= total * 0.5 ? 'ATEN√á√ÉO' : 'CR√çTICO'
  };
}

/**
 * Fun√ß√£o auxiliar para delay entre testes
 */
function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

/**
 * Verifica√ß√£o de depend√™ncias
 */
async function verificarDependencias() {
  console.log('üîç Verificando depend√™ncias do sistema...');

  try {
    // Verificar conectividade com a URL base
    const healthCheck = await fetch(`${BASE_URL}/api/health`).catch(() => null);
    if (!healthCheck) {
      console.log('‚ö†Ô∏è Aviso: Endpoint de sa√∫de n√£o dispon√≠vel, mas continuando...');
    }

    console.log('‚úÖ Depend√™ncias verificadas');
    return true;
  } catch (error) {
    console.log('‚ö†Ô∏è Alguns servi√ßos podem estar indispon√≠veis, mas continuando...');
    return true;
  }
}

// EXECU√á√ÉO PRINCIPAL
(async function main() {
  try {
    await verificarDependencias();
    const resultado = await executarTodosOsTestes();

    // Exit code baseado no resultado
    process.exit(resultado.status === 'CR√çTICO' ? 1 : 0);
  } catch (error) {
    console.error('\n‚ùå ERRO FATAL NO SISTEMA DE TESTES:', error);
    console.error('üîß Verifique a configura√ß√£o e tente novamente.');
    process.exit(1);
  }
})();