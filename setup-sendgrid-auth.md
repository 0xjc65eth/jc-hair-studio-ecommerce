# SendGrid Domain Authentication Setup Guide

## Overview

This guide provides step-by-step instructions for setting up proper domain authentication for SendGrid with JC Hair Studio's 62 ecommerce platform.

## Email Addresses Currently Used

Based on the codebase analysis, the following email addresses are configured:

### Primary Email Addresses
- **Orders/Notifications**: `orders@jchairstudios62.xyz`
- **Customer Support**: `suporte@jchairstudios62.xyz`
- **Contact Form**: `contato@jchairstudios62.xyz`

### Domain Variations Found
- `jchairstudios62.xyz` (Current primary domain)
- `jchairstudios62.com` (Alternative domain in some configs)
- `jchairstudio62.com` (Found in some legacy references)

## Step 1: Domain Verification in SendGrid

### 1.1 Access SendGrid Dashboard
1. Log into your SendGrid account at https://app.sendgrid.com
2. Navigate to **Settings** → **Sender Authentication**
3. Click **Authenticate Your Domain**

### 1.2 Domain Setup
1. Enter your domain: `jchairstudios62.xyz`
2. Select **Yes** for "Would you like to brand the links for this domain as well?"
3. Choose your DNS host (if using a common provider like Cloudflare, GoDaddy, etc.)

### 1.3 DNS Records Configuration
SendGrid will provide you with DNS records to add to your domain. You'll need to add:

#### CNAME Records (Example)
```
Host: s1._domainkey
Value: s1.domainkey.u12345678.wl123.sendgrid.net

Host: s2._domainkey
Value: s2.domainkey.u12345678.wl123.sendgrid.net

Host: em1234
Value: u12345678.wl123.sendgrid.net

Host: 12345678
Value: sendgrid.net
```

**Important**: The actual values will be unique to your SendGrid account. Use the exact values provided by SendGrid.

## Step 2: SPF Record Setup

### 2.1 SPF Configuration
Add or update your SPF record in DNS:

```
Type: TXT
Host: @ (or your root domain)
Value: v=spf1 include:sendgrid.net ~all
```

If you already have an SPF record, add `include:sendgrid.net` to it:
```
v=spf1 include:_spf.google.com include:sendgrid.net ~all
```

### 2.2 SPF Validation
- SPF helps prevent email spoofing
- Authorizes SendGrid to send emails on behalf of your domain
- Use SPF record checker tools to validate syntax

## Step 3: DKIM Setup

### 3.1 DKIM Configuration
DKIM records are automatically generated by SendGrid during domain authentication:

1. The CNAME records you added include DKIM keys
2. SendGrid manages the private keys securely
3. Email clients verify signatures using the public keys in DNS

### 3.2 DKIM Benefits
- Ensures email integrity
- Prevents email tampering
- Improves deliverability rates

## Step 4: DMARC Policy Setup

### 4.1 Basic DMARC Record
Add a DMARC policy to your DNS:

```
Type: TXT
Host: _dmarc
Value: v=DMARC1; p=quarantine; rua=mailto:dmarc@jchairstudios62.xyz; ruf=mailto:dmarc@jchairstudios62.xyz; fo=1
```

### 4.2 DMARC Policy Levels
- **p=none**: Monitor only (recommended for testing)
- **p=quarantine**: Send suspicious emails to spam folder
- **p=reject**: Reject emails that fail authentication (strictest)

### 4.3 Gradual DMARC Implementation
1. Start with `p=none` for monitoring
2. Monitor reports for 2-4 weeks
3. Gradually move to `p=quarantine`
4. Eventually implement `p=reject` for maximum security

## Step 5: Environment Variables Setup

### 5.1 Required Environment Variables
Update your `.env` file with:

```bash
# SendGrid Configuration
SENDGRID_API_KEY="SG.your-actual-api-key-here"
FROM_EMAIL="orders@jchairstudios62.xyz"
SUPPORT_EMAIL="suporte@jchairstudios62.xyz"
FROM_NAME="JC Hair Studio's 62"

# Additional email configuration
SENDGRID_FROM_EMAIL="orders@jchairstudios62.xyz"
```

### 5.2 Vercel Environment Variables
For production deployment, set these in Vercel:

1. Go to your Vercel project dashboard
2. Navigate to **Settings** → **Environment Variables**
3. Add each variable with production values

## Step 6: Verification Process

### 6.1 DNS Propagation
- DNS changes can take 24-48 hours to propagate globally
- Use DNS lookup tools to verify records are active
- SendGrid will automatically verify once DNS is propagated

### 6.2 SendGrid Verification Status
Check verification status in SendGrid dashboard:
1. Go to **Settings** → **Sender Authentication**
2. Look for green checkmarks next to your domain
3. All records must show "Verified" status

## Troubleshooting Common Issues

### Issue 1: DNS Records Not Propagating
**Solution:**
- Wait 24-48 hours for full propagation
- Use different DNS lookup tools to check multiple DNS servers
- Contact your DNS provider if issues persist

### Issue 2: SPF Record Conflicts
**Symptoms:** Multiple SPF records or syntax errors
**Solution:**
- Ensure only one SPF record exists per domain
- Combine multiple includes into single SPF record
- Validate SPF syntax using online tools

### Issue 3: DKIM Verification Failed
**Solution:**
- Verify CNAME records are exactly as provided by SendGrid
- Ensure no extra spaces or characters in DNS records
- Wait for DNS propagation and re-verify

### Issue 4: Email Delivery Issues
**Symptoms:** Emails going to spam or not delivering
**Solution:**
- Verify all authentication methods are working
- Check domain reputation using sender reputation tools
- Review SendGrid analytics for bounce/spam reports
- Gradually warm up the domain with low-volume sending

## Step 7: Testing Email Authentication

### 7.1 Email Authentication Test
Send a test email and check headers:
1. Send email to your personal account
2. View email headers/source
3. Look for authentication results:
   - `Authentication-Results: spf=pass`
   - `Authentication-Results: dkim=pass`
   - `Authentication-Results: dmarc=pass`

### 7.2 Online Testing Tools
Use these tools to verify setup:
- MXToolbox (https://mxtoolbox.com/)
- Mail Tester (https://www.mail-tester.com/)
- DMARC Analyzer (https://www.dmarcanalyzer.com/)

## Step 8: Monitoring and Maintenance

### 8.1 Regular Monitoring
- Check SendGrid dashboard weekly for delivery statistics
- Monitor DMARC reports for authentication failures
- Track email reputation and deliverability rates

### 8.2 DMARC Reports Analysis
- Review aggregate reports (RUA) weekly
- Investigate forensic reports (RUF) for failed authentications
- Adjust policies based on legitimate vs. malicious traffic

### 8.3 Reputation Management
- Maintain low bounce rates (< 5%)
- Keep spam complaints minimal (< 0.1%)
- Use double opt-in for newsletter subscriptions
- Implement proper unsubscribe mechanisms

## Security Best Practices

### 8.1 API Key Security
- Store SendGrid API key securely in environment variables
- Use least-privilege API keys (mail send only)
- Rotate API keys regularly
- Never commit API keys to version control

### 8.2 Email Security
- Validate email addresses before sending
- Implement rate limiting for email sending
- Use secure HTTPS endpoints for email APIs
- Log email activities for audit purposes

## Emergency Procedures

### If SendGrid Account is Compromised
1. Immediately change SendGrid account password
2. Rotate all API keys
3. Review recent email activity logs
4. Contact SendGrid support
5. Update environment variables in all deployments

### If Domain Authentication Fails
1. Verify DNS records are still correct
2. Check for DNS provider changes
3. Re-verify domain in SendGrid
4. Implement fallback email service if needed

## Support Contacts

- **SendGrid Support**: https://support.sendgrid.com/
- **DNS Provider Support**: Contact your domain registrar
- **Technical Issues**: Document and test with verification script

---

## Next Steps

After completing this setup:
1. Run the domain verification script (`verify-domain.mjs`)
2. Test email sending functionality
3. Monitor delivery rates and authentication status
4. Set up fallback email service for redundancy

This guide ensures proper email authentication for professional, secure, and reliable email delivery from your JC Hair Studio's 62 ecommerce platform.